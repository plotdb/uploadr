!function(){var e,n;function u(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n]);return e}(e=function(e){var r=this;return this.root="string"==typeof(e=null==e?{}:e).root?document.querySelector(e.root):e.root,this.root||console.warn("[uploadr] warning: no node found for root ",e.root),this.evtHandler={},this.opt=u({},e),this.opt.provider=e.provider||{host:"native",config:{route:"/d/uploadr"}},this.progress=function(t){var n,e;if((n=(t.item||(t.item={})).node)&&(e=ld$.find(n,"[ld=progress]")[0]))return e.style.width=100*t.percent+"%",1<=t.percent?debounce(500).then(function(){var e;if(ld$.remove(n),~(e=r.lc.files.indexOf(t.item)))return r.lc.files.splice(e,1)}):void 0},this.lc={files:[]},this.init=proxise.once(function(){return r._init()}),this.init(),this}).prototype=u(Object.create(Object.prototype),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){for(var t,n,r,o,i=[],u=[],l=1,c=arguments.length;l<c;++l)u.push(arguments[l]);for(t=u,l=0,r=(n=this.evtHandler[e]||[]).length;l<r;++l)o=n[l],i.push(o.apply(this,t));return i},_init:function(){var i=this;return Promise.resolve().then(function(){var n,r=i.lc,c=function(e){var o=n.get("preview"),t=e.map(function(r){return new Promise(function(t,e){var n=new Image;return n.onload=function(){var e;return o&&((e=o.style).backgroundImage="url("+r.thumb+")",e.width=n.width+"px",e.height=n.height+"px"),t(u(((e={}).width=n.width,e.height=n.height,e),r))},n.src=r.thumb})});return Promise.all(t).then(function(){return r.files=(r.files||[]).concat(e),debounce(500)}).then(function(){return n.render(),i.fire("preview.done"),i.lc.loader&&i.lc.loader.off(),i.fire("file.chosen",r.files)})},t=function(n){return i.fire("preview.loading"),i.lc.loader&&i.lc.loader.on(),n=Array.from(n),new Promise(function(t,e){var u=[],l=function(r){var e,o,i=r.splice(0,1)[0];return i?(e=URL.createObjectURL(i),(o=new Image).onload=function(){var e=[o.width,o.height],t=e[0],n=e[1];return 200<t&&(t=(e=[200,200*n/t])[0],n=e[1]),150<n&&(t=(e=[150*t/n,150])[0],n=e[1]),(e=document.createElement("canvas")).width=t,e.height=n,e.getContext("2d").drawImage(o,0,0,t,n),e.toBlob(function(e){return u.push(e={thumb:URL.createObjectURL(e),file:i}),c([e]),l(r)})},o.src=e):t(u)};return l(n)})};return i.lc.view=n=new ldView({root:i.root,action:{input:{input:function(e){var n=e.node;return t(n.files).then(function(e){var t;if(n.value=null,t=n.form)return t.reset()})}},click:{upload:function(e){e.node;return i.upload().then(function(e){return i.clear(),e})},clear:function(e){e.node;return i.clear()}},drop:{drop:function(e){e.node;e=e.evt;return e.preventDefault(),t(e.dataTransfer.files)}},dragover:{drop:function(e){e.node;return e.evt.preventDefault()}}},init:{loader:function(e){e=e.node;return i.lc.loader=new ldloader({root:e})}},handler:{file:{list:function(){return r.files||[]},view:{action:{click:{delete:function(e){var e=e.context;if(~(e=r.files.indexOf(e)))return r.files.splice(e,1),r.view.render("file")}}},handler:{name:function(e){return e.node.textContent=e.context.file.name},size:function(e){return e.node.textContent=Math.round(e.context.file.size/1024)+"KB"},thumb:function(e){var t=e.node,e=e.context;return"img"===t.nodeName.toLowerCase()?t.setAttribute("src",e.thumb):t.style.backgroundImage="url("+e.thumb+")"}}}}}})})},get:function(){return this.lc.files},clear:function(){return this.lc.files.splice(0),this.lc.view.render()},upload:function(){var t=this;return n[this.opt.provider.host]({files:this.lc.files,progress:this.progress,opt:this.opt.provider.config}).then(function(e){return t.fire("upload.done",e),e}).catch(function(e){return t.fire("upload.fail",e),Promise.reject(e)})}}),e.ext=n={},(e.viewer=function(e){var t,n,r=this;return this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.root||console.warn("[uploadr] warning: no node found for root ",e.root),this.evtHandler={},this.lc=t={},this.files=t.files=[],this.view=n=new ldView({root:this.root,action:{click:{list:function(e){var t=e.node;if(e=ld$.parent(e.evt.target,"[data-src]",t))return t=e.getAttribute("data-src"),r.fire("choose",{url:t})}}},handler:{file:{list:function(){return t.files||[]},key:function(e){return e._id},view:{text:{size:function(e){e.context},name:function(e){e.context}},handler:{thumb:function(e){var t=e.node,e=e.context;if(t._load!==e.url)return t._load=e.url,t.style.opacity=0,"img"===t.nodeName.toLowerCase()?(t.setAttribute("src",e.url),t.onload=function(){return ld$.find(t.parentNode,"div[ld=thumb]").map(function(e){return e.style.opacity=1})}):t.style.backgroundImage="url("+e.url+")",t.setAttribute("data-src",e.url)}}}}}}),this.page=e.page instanceof ldpage?e.page:new ldpage(e.page||{}),this.page.init(),this.page.on("fetch",function(e){e=e.map(function(e){return e._id=Math.random(),e});return t.files=t.files.concat(e),n.render(),r.fire("fetch",e)}),this.page.on("finish",function(){return r.fire("finish")}),this.page.on("empty",function(){return r.fire("empty")}),this}).prototype=u(Object.create(Object.prototype),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){for(var t,n,r,o,i=[],u=[],l=1,c=arguments.length;l<c;++l)u.push(arguments[l]);for(t=u,l=0,r=(n=this.evtHandler[e]||[]).length;l<r;++l)o=n[l],i.push(o.apply(this,t));return i},fetch:function(){return this.page.fetch()},reset:function(){return this.page.reset(),this.lc.files=[],this.view.render()}}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof window&&null!==window&&(window.uploadr=e)}.call(this);
